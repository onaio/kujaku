<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>OfflineServiceHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">debugAndroidTest</a> &gt; <a href="index.source.html" class="el_package">io.ona.kujaku.helpers</a> &gt; <span class="el_source">OfflineServiceHelper.java</span></div><h1>OfflineServiceHelper.java</h1><pre class="source lang-java linenums">package io.ona.kujaku.helpers;

import android.content.Context;
import android.content.Intent;
import android.support.annotation.NonNull;

import com.mapbox.mapboxsdk.geometry.LatLng;

import io.ona.kujaku.data.realm.objects.MapBoxOfflineQueueTask;
import io.ona.kujaku.services.MapboxOfflineDownloaderService;
import io.ona.kujaku.utils.Constants;

/**
 * Created by Ephraim Kigamba - ekigamba@ona.io on 05/12/2018
 */

<span class="nc" id="L17">public abstract class OfflineServiceHelper {</span>

    /**
     * Requests an offline map download for you from the {@link MapboxOfflineDownloaderService}.
     * You should register a {@link android.content.BroadcastReceiver} with {@link android.content.IntentFilter} action
     * {@link io.ona.kujaku.utils.Constants#INTENT_ACTION_MAP_DOWNLOAD_SERVICE_STATUS_UPDATES}.
     * See {@link MapboxOfflineDownloaderService} for more on the available updates
     *
     * @param context
     * @param mapName
     * @param mapboxStyleUrl
     * @param mapBoxAccessToken
     * @param topLeftBound
     * @param topRightBound
     * @param bottomRightBound
     * @param bottomLeftBound
     * @param zoomRange
     */
    public static void requestOfflineMapDownload(@NonNull Context context, @NonNull String mapName,
                                          @NonNull String mapboxStyleUrl, @NonNull String mapBoxAccessToken,
                                          @NonNull LatLng topLeftBound, @NonNull LatLng topRightBound,
                                          @NonNull LatLng bottomRightBound, @NonNull LatLng bottomLeftBound,
                                          @NonNull ZoomRange zoomRange) {
<span class="nc" id="L40">        requestOfflineMapDownload(context, mapName, mapboxStyleUrl, mapBoxAccessToken, topLeftBound, topRightBound, bottomRightBound, bottomLeftBound, zoomRange,6000l);</span>
<span class="nc" id="L41">    }</span>


    /**
     * Requests an offline map download for you from the {@link MapboxOfflineDownloaderService}.
     * You should register a {@link android.content.BroadcastReceiver} with {@link android.content.IntentFilter} action
     * {@link io.ona.kujaku.utils.Constants#INTENT_ACTION_MAP_DOWNLOAD_SERVICE_STATUS_UPDATES}.
     * See {@link MapboxOfflineDownloaderService} for more on the available updates
     *
     * @param context
     * @param mapName
     * @param mapboxStyleUrl
     * @param mapBoxAccessToken
     * @param topLeftBound
     * @param topRightBound
     * @param bottomRightBound
     * @param bottomLeftBound
     * @param zoomRange
     * @param tileDownloadLimit the tile download limit
     */
    public static void requestOfflineMapDownload(@NonNull Context context, @NonNull String mapName,
                                                 @NonNull String mapboxStyleUrl, @NonNull String mapBoxAccessToken,
                                                 @NonNull LatLng topLeftBound, @NonNull LatLng topRightBound,
                                                 @NonNull LatLng bottomRightBound, @NonNull LatLng bottomLeftBound,
                                                 @NonNull ZoomRange zoomRange, @NonNull Long tileDownloadLimit) {
<span class="nc" id="L66">        Intent intent = new Intent(context, MapboxOfflineDownloaderService.class);</span>
<span class="nc" id="L67">        intent.putExtra(Constants.PARCELABLE_KEY_SERVICE_ACTION, MapboxOfflineDownloaderService.SERVICE_ACTION.DOWNLOAD_MAP);</span>
<span class="nc" id="L68">        intent.putExtra(Constants.PARCELABLE_KEY_STYLE_URL, mapboxStyleUrl);</span>
<span class="nc" id="L69">        intent.putExtra(Constants.PARCELABLE_KEY_MAP_UNIQUE_NAME, mapName);</span>
<span class="nc" id="L70">        intent.putExtra(Constants.PARCELABLE_KEY_MAPBOX_ACCESS_TOKEN, mapBoxAccessToken);</span>
<span class="nc" id="L71">        intent.putExtra(Constants.PARCELABLE_KEY_TOP_LEFT_BOUND, topLeftBound);</span>
<span class="nc" id="L72">        intent.putExtra(Constants.PARCELABLE_KEY_TOP_RIGHT_BOUND, topRightBound);</span>
<span class="nc" id="L73">        intent.putExtra(Constants.PARCELABLE_KEY_BOTTOM_RIGHT_BOUND, bottomRightBound);</span>
<span class="nc" id="L74">        intent.putExtra(Constants.PARCELABLE_KEY_BOTTOM_LEFT_BOUND, bottomLeftBound);</span>
<span class="nc" id="L75">        intent.putExtra(Constants.PARCELABLE_KEY_MIN_ZOOM, zoomRange.getMinZoom());</span>
<span class="nc" id="L76">        intent.putExtra(Constants.PARCELABLE_KEY_MAX_ZOOM, zoomRange.getMaxZoom());</span>
<span class="nc" id="L77">        intent.putExtra(Constants.PARCELABLE_KEY_MAPBOX_DOWNLOAD_TILE_LIMIT,tileDownloadLimit);</span>

<span class="nc" id="L79">        context.startService(intent);</span>
<span class="nc" id="L80">    }</span>

    /**
     * Requests the deletion of an offline map from {@Link MapboxOfflineDownloaderService}. This is
     * an offline map already downloaded or queued to download using the {@link MapboxOfflineDownloaderService}
     *
     * @param context
     * @param mapName
     * @param mapBoxAccessToken
     */
    public static void deleteOfflineMap(@NonNull Context context, @NonNull String mapName, @NonNull String mapBoxAccessToken) {
<span class="nc" id="L91">        Intent intent = new Intent(context, MapboxOfflineDownloaderService.class);</span>
<span class="nc" id="L92">        intent.putExtra(Constants.PARCELABLE_KEY_SERVICE_ACTION, MapboxOfflineDownloaderService.SERVICE_ACTION.DELETE_MAP);</span>
<span class="nc" id="L93">        intent.putExtra(Constants.PARCELABLE_KEY_MAP_UNIQUE_NAME, mapName);</span>
<span class="nc" id="L94">        intent.putExtra(Constants.PARCELABLE_KEY_MAPBOX_ACCESS_TOKEN, mapBoxAccessToken);</span>

<span class="nc" id="L96">        context.startService(intent);</span>
<span class="nc" id="L97">    }</span>

    /**
     * Requests the {@Link MapboxOfflineDownloaderService} to stop downloading the current map referenced
     * by the {@code mapName} passed. This will also download all the resources of the
     * {@link com.mapbox.mapboxsdk.offline.OfflineRegion} downloaded that are not shared with other {@link com.mapbox.mapboxsdk.offline.OfflineRegion}
     *
     * @param context
     * @param mapName
     * @param mapBoxAccessToken
     */
    public static void stopMapDownload(@NonNull Context context, @NonNull String mapName, @NonNull String mapBoxAccessToken) {
<span class="nc" id="L109">        Intent stopDownloadIntent = new Intent(context, MapboxOfflineDownloaderService.class);</span>
<span class="nc" id="L110">        stopDownloadIntent.putExtra(Constants.PARCELABLE_KEY_SERVICE_ACTION, MapboxOfflineDownloaderService.SERVICE_ACTION.STOP_CURRENT_DOWNLOAD);</span>
<span class="nc" id="L111">        stopDownloadIntent.putExtra(Constants.PARCELABLE_KEY_MAP_UNIQUE_NAME, mapName);</span>
<span class="nc" id="L112">        stopDownloadIntent.putExtra(Constants.PARCELABLE_KEY_MAPBOX_ACCESS_TOKEN, mapBoxAccessToken);</span>
<span class="nc" id="L113">        stopDownloadIntent.putExtra(Constants.PARCELABLE_KEY_DELETE_TASK_TYPE, MapBoxOfflineQueueTask.TASK_TYPE_DOWNLOAD);</span>

<span class="nc" id="L115">        context.startService(stopDownloadIntent);</span>
<span class="nc" id="L116">    }</span>

    public static class ZoomRange {
        private double minZoom;
        private double maxZoom;

<span class="nc" id="L122">        public ZoomRange(double minZoom, double maxZoom) {</span>
<span class="nc" id="L123">            this.minZoom = minZoom;</span>
<span class="nc" id="L124">            this.maxZoom = maxZoom;</span>
<span class="nc" id="L125">        }</span>

        public double getMinZoom() {
<span class="nc" id="L128">            return minZoom;</span>
        }

        public double getMaxZoom() {
<span class="nc" id="L132">            return maxZoom;</span>
        }
    }


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span>Generated by the Android Gradle plugin 3.2.0</div></body></html>