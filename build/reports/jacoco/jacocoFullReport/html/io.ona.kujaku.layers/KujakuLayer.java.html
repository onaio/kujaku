<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>KujakuLayer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">kujaku</a> &gt; <a href="index.source.html" class="el_package">io.ona.kujaku.layers</a> &gt; <span class="el_source">KujakuLayer.java</span></div><h1>KujakuLayer.java</h1><pre class="source lang-java linenums">package io.ona.kujaku.layers;

import android.graphics.Color;
import android.graphics.PointF;
import android.support.annotation.ColorInt;
import android.support.annotation.NonNull;
import android.support.annotation.Nullable;

import com.mapbox.geojson.FeatureCollection;
import com.mapbox.mapboxsdk.maps.MapboxMap;
import com.mapbox.mapboxsdk.style.expressions.Expression;

import java.util.ArrayList;
import java.util.List;

/**
 * Created by Ephraim Kigamba - ekigamba@ona.io on 18/02/2019
 */
<span class="fc" id="L19">public abstract class KujakuLayer {</span>

<span class="fc" id="L21">    private boolean isRemoved = false;</span>
<span class="fc" id="L22">    protected boolean visible = false;</span>

    /**
     * Adds the layer to a {@link MapboxMap}
     *
     * @param mapboxMap
     */
    public abstract void addLayerToMap(@NonNull MapboxMap mapboxMap);

    /**
     * Enables the layer on the {@link MapboxMap} in case it is not already
     * {@link com.mapbox.mapboxsdk.style.layers.Property#VISIBLE}. If the layer is not on the map,
     * nothing happens
     *
     * @param mapboxMap
     */
    public abstract void enableLayerOnMap(@NonNull MapboxMap mapboxMap);

    /**
     * Disables the layer if it is already on the {@link MapboxMap}
     *
     * @param mapboxMap
     */
    public abstract void disableLayerOnMap(@NonNull MapboxMap mapboxMap);

    /**
     * Used to retrieve the layer IDs used by this {@link KujakuLayer}
     *
     * @return an array of layer IDs
     */
    @NonNull
    public abstract String[] getLayerIds();

    public abstract boolean removeLayerOnMap(@NonNull MapboxMap mapboxMap);

    public abstract void updateFeatures(@NonNull FeatureCollection featureCollection);

    public abstract FeatureCollection getFeatureCollection() ;

    public boolean isRemoved() {
<span class="nc" id="L62">        return isRemoved;</span>
    }

    public void setRemoved(boolean isRemoved) {
<span class="fc" id="L66">        this.isRemoved = isRemoved;</span>
<span class="fc" id="L67">    }</span>

    /**
     * Used to check if the layer has been enabled on the {@link MapboxMap}
     *
     * @return {@code true} if the layer is enabled, {@code false} otherwise
     */
    public boolean isVisible() {
<span class="nc" id="L75">        return visible;</span>
    }

    /**
     * Return the clicked KujakuLayer
     *
     * @param pixel
     * @param kujakuLayers
     * @param mapboxMap
     * @return
     */
    public static KujakuLayer getKujakuLayerSelected(PointF pixel, ArrayList&lt;KujakuLayer&gt; kujakuLayers, MapboxMap mapboxMap) {
<span class="nc" id="L87">        List&lt;String&gt; kujakuLayerListIds = new ArrayList&lt;&gt;();</span>

<span class="nc bnc" id="L89" title="All 2 branches missed.">        for (KujakuLayer layer: kujakuLayers) {</span>
<span class="nc bnc" id="L90" title="All 2 branches missed.">            for (String layerId : layer.getLayerIds()) {</span>
<span class="nc" id="L91">                kujakuLayerListIds.add(layerId);</span>
            }

<span class="nc" id="L94">            String[] kujakuLayerIds = new String[kujakuLayerListIds.size()];</span>
<span class="nc" id="L95">            kujakuLayerIds = kujakuLayerListIds.toArray(kujakuLayerIds);</span>
<span class="nc" id="L96">            List&lt;com.mapbox.geojson.Feature&gt; features = mapboxMap.queryRenderedFeatures(pixel, null, kujakuLayerIds);</span>

<span class="nc bnc" id="L98" title="All 2 branches missed.">            if (features.size() &gt; 0) {</span>
<span class="nc" id="L99">                return layer;</span>
            }
<span class="nc" id="L101">        }</span>

<span class="nc" id="L103">        return null;</span>
    }

    /**
     * Abstract class for Builder
     * @param &lt;T&gt; Object to build
     * @param &lt;B&gt; Builder
     */
    public abstract static class Builder&lt;T extends KujakuLayer, B extends Builder&lt;T, B&gt;&gt; {

        protected FeatureCollection featureCollection;
<span class="fc" id="L114">        protected float boundaryWidth = 5;</span>
<span class="fc" id="L115">        @ColorInt</span>
        protected int boundaryColor = Color.WHITE;
        protected float labelTextSize;
<span class="fc" id="L118">        @ColorInt</span>
        protected int labelColorInt = Color.BLACK;
        protected String belowLayerId;
<span class="fc" id="L121">        protected String labelProperty = &quot;&quot;;</span>
        protected Expression labelTextSizeExpression;

<span class="fc" id="L124">        public Builder(@NonNull FeatureCollection featureCollection) {</span>
<span class="fc" id="L125">            this.featureCollection = featureCollection;</span>
<span class="fc" id="L126">        }</span>

        /**
         * The solution for the unchecked cast warning.
         */
        public abstract B getThis();

        public FeatureCollection getFeatureCollection() {
<span class="fc" id="L134">            return featureCollection;</span>
        }

        public B setBoundaryWidth(float boundaryWidth) {
<span class="fc" id="L138">            this.boundaryWidth = boundaryWidth;</span>
<span class="fc" id="L139">            return getThis();</span>
        }

        public B setBoundaryColor(@ColorInt int boundaryColor) {
<span class="fc" id="L143">            this.boundaryColor = boundaryColor;</span>
<span class="fc" id="L144">            return getThis();</span>
        }

        public B setLabelTextSize(float labelTextSize) {
<span class="fc" id="L148">            this.labelTextSize = labelTextSize;</span>
<span class="fc" id="L149">            return getThis();</span>
        }

        public B setLabelColorInt(@ColorInt int labelColorInt) {
<span class="fc" id="L153">            this.labelColorInt = labelColorInt;</span>
<span class="fc" id="L154">            return getThis();</span>
        }

        public B addBelowLayer(@NonNull String belowLayerId) {
<span class="nc" id="L158">            this.belowLayerId = belowLayerId;</span>
<span class="nc" id="L159">            return getThis();</span>
        }

        public B setLabelProperty(@NonNull String labelProperty) {
<span class="fc" id="L163">            this.labelProperty = labelProperty;</span>
<span class="fc" id="L164">            return getThis();</span>
        }

        /**
         * The passed {@code labelTextSizeExpression} overrides any previously set label size using
         * {@link BoundaryLayer.Builder#setLabelTextSize(float)}. To remove this expression, pass a {@code null}
         * to this method so that the previously set label size is used. This method is availed because
         * the default label size maintains it's size irrespective of the zoom level
         *
         * @param labelTextSizeExpression
         * @return
         */
        public B setLabelTextSizeExpression(@Nullable Expression labelTextSizeExpression) {
<span class="fc" id="L177">            this.labelTextSizeExpression = labelTextSizeExpression;</span>
<span class="fc" id="L178">            return getThis();</span>
        }

        public abstract T build();
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>